<div class="no-padding col-xs-6"
     *ngFor="let category of eventsData; let index = index;"
     [class.spacer]="(index === 0) || (index === 1)">

    <button class="button"
            [disabled]="category.items === null"
            (click)="toggleCategory(category)"
            [class.disabled]="category.items === null"
            [class.button-active]="activeCategory(category.id)">
        {{category.enName}} / {{category.vnName}}
    </button>

</div>

<ng-container *ngIf="selectedCategory">
    <div *ngFor="let item of selectedCategory.items; let index = index">
        <button class="button"
                type="button"
                (click)="item.isCollapsed = !item.isCollapsed"
                [attr.aria-expanded]="!item.isCollapsed"
                [class.spacer]="index === 0">
            <!--(click)="cancelEdit(index)"-->
            <span style="float: left; text-transform: none; margin-right: -150px;">Category Position: {{item.position}}</span>
            <span style="align-content: center">{{item.enTitle}} / {{item.vnTitle}}</span>
        </button>

        <!-- None Edit Mode -->
        <div class="row row-eq-height no-margin editable-container"
             [ngbCollapse]="!item.isCollapsed" *ngIf="!item.editToggle">

            <!-- Item Details -->
            <div class="col-xs-9">

                <!-- English Title & Category -->
                <div class="row no-margin">

                    <p class="col-xs-2">English Title:</p>
                    <p class="col-xs-6">{{item.enTitle}}</p>

                    <p class="col-xs-2">Category:</p>
                    <p class="col-xs-2">{{selectedCategory.enName}}/<br>{{selectedCategory.vnName}}</p>

                </div>

                <!-- Vietnamese Title & Position -->
                <div class="row no-margin">

                    <p class="col-xs-2">Vietnamese Title:</p>
                    <p class="col-xs-6">{{item.vnTitle}}</p>

                    <p class="col-xs-2">Position:</p>
                    <p class="col-xs-2">{{item.position}}</p>

                </div>

                <!-- Description -->
                <div class="row no-margin">

                    <p class="col-xs-6">English Description:</p>
                    <p class="col-xs-6">Vietnamese Description:</p>

                    <p class="col-xs-6">{{item.enDescription}}</p>
                    <p class="col-xs-6">{{item.vnDescription}}</p>

                </div>

                <!-- Dates and Times -->
                <div class="row row-eq-height no-margin">

                    <!-- Dates -->
                    <div class="col-xs-6 no-padding">

                        <p class="col-xs-6">Start Date:</p>
                        <p class="col-xs-6">{{item.startDate}}</p>

                        <p class="col-xs-6">End Date:</p>
                        <p class="col-xs-6">{{item.endDate}}</p>

                    </div>

                    <!-- Times -->
                    <div class="col-xs-6 no-padding">

                        <p class="col-xs-6">Start Time:</p>
                        <p class="col-xs-6">{{item.startTimeString}}</p>

                        <p class="col-xs-6">End Time:</p>
                        <p class="col-xs-6">{{item.endTimeString}}</p>

                    </div>

                </div>

                <!--Created at and editedAt-->
                <div class="row no-margin">

                    <p class="col-xs-3">Created at:</p>
                    <p class="col-xs-3">{{item.createdAt.date.substring(0, 19)}}</p>

                    <p class="col-xs-3">Last edited at:</p>
                    <p class="col-xs-3">{{item.editedAt.date.substring(0, 19)}}</p>

                </div>

            </div>

            <!-- Buttons -->
            <div class="col-xs-3">

                <button class="button-edit"
                        (click)="moveUp(index)"
                        [disabled]="index === 0 || updating"
                        [class.disabled]="index === 0 || updating">
                    Move up<img src="/assets/icons/icon-arrow-up-25x25.png">
                </button>

                <button class="button-edit"
                        (click)="moveDown(index)"
                        [disabled]="lastItem(index) || updating"
                        [class.disabled]="lastItem(index) || updating">
                    Move down<img src="/assets/icons/icon-arrow-down-25x25.png">
                </button>

                <button class="button-edit"
                        (click)="initializeEdit(item, index);"
                        [disabled]="updating"
                        [class.disabled]="updating">
                    Edit<img src="/assets/icons/icon-edit-25x25.png">
                </button>

                <button class="button-edit button-delete"
                        (click)="initializeDelete(item)"
                        [disabled]="updating"
                        [class.disabled]="updating">
                    Delete<img src="/assets/icons/icon-delete-25x25.png">
                </button>

            </div>


        </div>

        <!-- Form -->
        <form class="row row-eq-height no-margin editable-container"
              [ngbCollapse]="!item.isCollapsed"
              #menuItem="ngForm" *ngIf="item.editToggle">

            <!-- Item Details -->
            <div class="col-xs-9">

                <!-- English Title & Category -->
                <div class="row no-margin">

                    <label class="col-xs-2" for="enTitle">English Title:</label>
                    <input class="col-xs-6"
                           id="enTitle"
                           name="enTitle"
                           type="text"
                           minlength="4"
                           maxlength="255"
                           required
                           (change)="formChange()"
                           [(ngModel)]="model.enTitle"
                           #enTitle="ngModel">

                    <label class="col-xs-2" for="category">Category:</label>
                    <select class="col-xs-2"
                            id="category"
                            name="category"
                            required
                            (change)="checkCategory()"
                            [(ngModel)]="model.categoryId"
                            #category="ngModel">

                        <option *ngFor="let category of eventsData"
                                [ngValue]="category.id">
                            {{category.enName}} / {{category.vnName}}
                        </option>

                    </select>

                </div>

                <!-- Vietnamese Title & Position -->
                <div class="row no-margin">

                    <label class="col-xs-2" for="vnTitle">Vietnamese Title:</label>
                    <input class="col-xs-6"
                           id="vnTitle"
                           name="vnTitle"
                           type="text"
                           minlength="4"
                           maxlength="255"
                           required
                           (change)="formChange()"
                           [(ngModel)]="model.vnTitle"
                           #vnTitle="ngModel">

                    <p class="col-xs-2">Position:</p>
                    <p class="col-xs-2">{{model.position}}</p>

                </div>

                <!-- Description -->
                <div class="row no-margin">

                    <label class="col-xs-2" for="enDescription">English Description:</label>
                    <textarea class="col-xs-10"
                              id="enDescription"
                              name="enDescription"
                              minlength="4"
                              required
                              (change)="formChange()"
                              [disabled]="model.disableDescription"
                              [(ngModel)]="model.enDescription"
                              #enDescription="ngModel"></textarea>

                    <label class="col-xs-2" for="vnDescription">Vietnamese Description:</label>
                    <textarea class="col-xs-10"
                              id="vnDescription"
                              name="vnDescription"
                              minlength="4"
                              required
                              (change)="formChange()"
                              [disabled]="model.disableDescription"
                              [(ngModel)]="model.vnDescription"
                              #vnDescription="ngModel"></textarea>

                </div>

                <!-- Dates and Times -->
                <div class="row row-eq-height no-margin">

                    <!-- Start/End Date -->
                    <div class="col-xs-8 no-padding date-time-container">

                        <!-- Uses End Date -->
                        <div class="col-xs-12">
                            <label for="usesEndDate">Event spans over more than 1 day</label>
                            <input id="usesEndDate"
                                   type="checkbox"
                                   name="usesEndDate"
                                   [(ngModel)]="model.usesEndDate"
                                   (change)="toggleEndDate(); model.dateTimeValidate()"
                                   #usesEndDate="ngModel">
                        </div>

                        <!-- Date Picker -->
                        <div class="col-xs-12">
                            <ngb-datepicker #dp (select)="onDateSelection($event)"
                                            (click)="model.dateTimeValidate()"
                                            [class.date-picker]="true"
                                            [displayMonths]="monthsDisplayed"
                                            [dayTemplate]="t"
                                            outsideDays="hidden">
                            </ngb-datepicker>

                            <ng-template #t let-date let-focused="focused">
                      <span class="custom-day"
                            [class.focused]="focused"
                            [class.range]="isRange(date)"
                            [class.faded]="isHovered(date) || isInside(date)"
                            (mouseenter)="hoveredDate = date"
                            (mouseleave)="hoveredDate = null">
                        {{ date.day }}
                      </span>
                            </ng-template>
                        </div>

                    </div>

                </div>

                <!--Created at and editedAt-->
                <div class="row no-margin">

                    <p class="col-xs-3">Created at:</p>
                    <p class="col-xs-3">{{model.createdAt.date.substring(0, 19)}}</p>

                    <p class="col-xs-3">Last edited at:</p>
                    <p class="col-xs-3">{{model.editedAt.date.substring(0, 19)}}</p>

                </div>

            </div>

            <!-- Buttons -->
            <div class="col-xs-3">

                <button class="button-edit"
                        (click)="moveUp(index)"
                        [disabled]="index === 0 || updating"
                        [class.disabled]="index === 0 || updating">
                    Move up<img src="/assets/icons/icon-arrow-up-25x25.png">
                </button>

                <button class="button-edit"
                        (click)="moveDown(index)"
                        [disabled]="lastItem(index) || updating"
                        [class.disabled]="lastItem(index) || updating">
                    Move down<img src="/assets/icons/icon-arrow-down-25x25.png">
                </button>

                <button class="button-edit"
                        [disabled]="updating"
                        (click)="cancelEdit(index);"
                        [class.disabled]="updating">
                    Cancel<img src="/assets/icons/icon-cancel-25x25.png">
                </button>

                <button class="button-edit">
                    <!--(click)="initializeSave(index)"-->
                    <!--[disabled]="menuItem.form.invalid || updating || !hasChanged"-->
                    <!--[class.invalid]="menuItem.form.invalid || !hasChanged"-->
                    <!--[class.disabled]="updating">-->
                    Save<img src="/assets/icons/icon-save-25x25.png">
                </button>

                <button class="button-edit button-delete"
                        (click)="initializeDelete(item)"
                        [class.disabled]="updating">
                    Delete<img src="/assets/icons/icon-delete-25x25.png">
                </button>

                <div class="warning">
                    <p class="warning" *ngIf="model.categoryId !== selectedCategory.id">
                        You have selected to move this item to a different category
                    </p>
                </div>

            </div>

        </form>


    </div>
</ng-container>
